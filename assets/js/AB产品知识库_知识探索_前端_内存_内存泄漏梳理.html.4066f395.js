"use strict";(self.webpackChunkmy_vuepress_site=self.webpackChunkmy_vuepress_site||[]).push([[8636],{11549:(n,s,a)=>{a.r(s),a.d(s,{comp:()=>B,data:()=>D});var e=a(20641);const t=a.p+"assets/img/1.032b3d50.png",p=a.p+"assets/img/2.d6a2e361.png",o=a.p+"assets/img/3.984afdab.png",i=a.p+"assets/img/4.d4ba2bf8.png",l=a.p+"assets/img/5.b2da8c9e.png",r=a.p+"assets/img/6.e2c2a4a8.png",c=a.p+"assets/img/7.aef5e885.png",d=a.p+"assets/img/8.3eee2a79.png",g=a.p+"assets/img/9.f14c2ac8.png",u=a.p+"assets/img/10.3858d43a.png",m=a.p+"assets/img/11.9a5a3e14.png",h=a.p+"assets/img/12.052c5835.png",k=a.p+"assets/img/13.65db4b75.png",b=a.p+"assets/img/14.0f3359f0.png",v=a.p+"assets/img/15.77b10dce.png",f=a.p+"assets/img/16.e2dab5ba.png",w=a.p+"assets/img/17.b07a224c.png",E=a.p+"assets/img/18.0012f243.png",x=a.p+"assets/img/19.2b52c4f2.png",A=a.p+"assets/img/20.babd68a3.png",j=a.p+"assets/img/21.cb2bcbd7.png",_={},B=(0,a(66262).A)(_,[["render",function(n,s){return(0,e.uX)(),(0,e.CE)("div",null,s[0]||(s[0]=[(0,e.Fv)('<h2 id="相关知识" tabindex="-1"><a class="header-anchor" href="#相关知识"><span>相关知识</span></a></h2><p><a href="https://www.tapd.cn/65362886/markdown_wikis/show/#1165362886001002684" target="_blank" rel="noopener noreferrer">内存术语（译）</a><a href="https://www.tapd.cn/65362886/markdown_wikis/show/#1165362886001002685" target="_blank" rel="noopener noreferrer">修复内存问题（译）</a><a href="https://www.tapd.cn/65362886/markdown_wikis/show/#1165362886001002687" target="_blank" rel="noopener noreferrer">录制内存快照（译）</a></p><h2 id="出现内内存泄漏的情况" tabindex="-1"><a class="header-anchor" href="#出现内内存泄漏的情况"><span>出现内内存泄漏的情况</span></a></h2><h3 id="console-log" tabindex="-1"><a class="header-anchor" href="#console-log"><span>console.log</span></a></h3><p>看下面代码：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token keyword">let</span> template <span class="token operator">=</span> <span class="token string">&#39;Lorem ipsum dolor, sit amet consectetur adipisicing elit. Sint animi cumque perspiciatis deserunt quam exercitationem unde tenetur debitis veritatis suscipit, dolorem veniam sequi rerum nisi, repudiandae qui ea dolor. Laboriosam?&#39;</span><span class="token punctuation">,</span></span>\n<span class="line">    count <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span></span>\n<span class="line"><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>\n<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>template<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>\n<span class="line"><span class="token punctuation">}</span></span>\n<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>结果如下图：</p><p><img src="'+t+'" alt="console log leak"></p><h3 id="事件监听" tabindex="-1"><a class="header-anchor" href="#事件监听"><span>事件监听</span></a></h3><p>这里有两种，一种我们直接使用<code>addEventListener</code>进行事件监听，另一种是vue提供的事件监听机制。</p><p><strong>原生的addEventListener</strong></p><p>通过分析下列内存截图：</p><p><img src="'+p+'" alt="leak component"></p><p>跳转到对应的视图：</p><p><img src="'+o+'" alt="leak component bound fn"></p><p>可以通过鼠标hover查看当前组件的信息：</p><p><img src="'+i+'" alt="leak component bound this"></p><p>通过上述分析，找到对应文件，发现对应代码。原因是使用了<code>addEventListener</code>但未在组件销毁时进行移除操作。</p><p><img src="'+l+'" alt="leak component popover on"></p><p><strong>vue @event</strong></p><p>在看下面一个内存截图：</p><p><img src="'+r+'" alt="vue on leak"></p><p>通过右键跳转到对应的位置：</p><p><img src="'+c+'" alt="vue on native bind"></p><p>根据分析找到对应代码。</p><p><img src="'+d+'" alt="vue-on-input"></p><p>该问题为vue本身问题，由于使用<code>v2.6.14</code>版本并未修复，已有<a href="https://github.com/vuejs/vue/pull/10085" target="_blank" rel="noopener noreferrer">PR</a>计划在<code>v2.6.15</code>版本修复，却迟迟没有发布，但在<code>v2.7</code>版本中已经修复了。</p><p>解决方案如下：</p><p><img src="'+g+'" alt="vue on resolve"></p><h3 id="mutationobserver" tabindex="-1"><a class="header-anchor" href="#mutationobserver"><span>MutationObserver</span></a></h3><p>这是一种新的内存泄漏问题，如下图：</p><p><img src="'+u+'" alt="select mutationobserver leak"></p><p>通过分析找到源码位置：</p><p><img src="'+m+'" alt="select mutationobserver source"></p><p>解决方案如下：</p><p><img src="'+h+'" alt="select mutationobserver resolve"></p><h3 id="msgbox-inject" tabindex="-1"><a class="header-anchor" href="#msgbox-inject"><span>msgbox inject</span></a></h3><p>但是还没有完，解决了上面的问题内存快照变成这样了：</p><p><img src="'+k+'" alt="inject component"></p><p>通过鼠标悬浮查看当前组件的信息：</p><p><img src="'+b+'" alt="inject component msgbox"></p><p>定位源码位置：</p><p><img src="'+v+'" alt="inject component msgboxinject"></p><h3 id="小结" tabindex="-1"><a class="header-anchor" href="#小结"><span>小结</span></a></h3><p>到这里基本组件库的问题已经处理大部分了，但是路还很长。因为实际的工程中还有fc组件库，还有我们的SDK，还有交易代码，这些都可能造成内存泄漏。</p><h3 id="开始新的探索" tabindex="-1"><a class="header-anchor" href="#开始新的探索"><span>开始新的探索</span></a></h3><p><strong><strong>auf_menu_cb</strong></strong></p><p><img src="'+f+'" alt="leak auf"></p><p><strong>compareData</strong></p><p><img src="'+w+'" alt="leak compare 1"></p><p>根据上面的经验，查看这个<code>native_bind</code>的信息：</p><p><img src="'+E+'" alt="leak compare 2"></p><p><strong>Trade</strong></p><p><img src="'+x+'" alt="leak Trade"></p><p><strong>listeners</strong></p><p><img src="'+A+'" alt="leak listeners 1"></p><p>查看这个<code>listeners</code>所在的对象：</p><p><img src="'+j+'" alt="leak listeners 2"></p><h3 id="and-so-on" tabindex="-1"><a class="header-anchor" href="#and-so-on"><span>AND SO ON</span></a></h3>',59)]))}]]),D=JSON.parse('{"path":"/AB%E4%BA%A7%E5%93%81%E7%9F%A5%E8%AF%86%E5%BA%93/%E7%9F%A5%E8%AF%86%E6%8E%A2%E7%B4%A2/%E5%89%8D%E7%AB%AF/%E5%86%85%E5%AD%98/%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E6%A2%B3%E7%90%86.html","title":"","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"相关知识","slug":"相关知识","link":"#相关知识","children":[]},{"level":2,"title":"出现内内存泄漏的情况","slug":"出现内内存泄漏的情况","link":"#出现内内存泄漏的情况","children":[{"level":3,"title":"console.log","slug":"console-log","link":"#console-log","children":[]},{"level":3,"title":"事件监听","slug":"事件监听","link":"#事件监听","children":[]},{"level":3,"title":"MutationObserver","slug":"mutationobserver","link":"#mutationobserver","children":[]},{"level":3,"title":"msgbox inject","slug":"msgbox-inject","link":"#msgbox-inject","children":[]},{"level":3,"title":"小结","slug":"小结","link":"#小结","children":[]},{"level":3,"title":"开始新的探索","slug":"开始新的探索","link":"#开始新的探索","children":[]},{"level":3,"title":"AND SO ON","slug":"and-so-on","link":"#and-so-on","children":[]}]}],"git":{"updatedTime":1727145923000,"contributors":[{"name":"wangaoqi","email":"wangaoqi@agree.com.cn","commits":1}]},"filePathRelative":"AB产品知识库/知识探索/前端/内存/内存泄漏梳理.md"}')}}]);