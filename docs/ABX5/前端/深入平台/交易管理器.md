---
outline: deep
---

# 交易管理器 {#交易管理器}

创建，销毁，管理交易以及面板

::: tip `概念`
概念一: 同步为阻塞，需要等待返回；异步非阻塞，无需等待返回；

概念二: `有关联`意为交易之间有父子关系,即父交易被销毁时子交易会先被销毁,否则无关联
:::

::: warning `结论`
结论一: 交易 A 使用`同步方法`打开交易 B,认为是`有关联`则交易 A 是交易 B 的父交易，当交易 A 关闭时会先关闭交易 B;同步交易会有等待提示框，可自定义

结论二: 交易 A 使用`异步方法`打开交易 B,认为`无关联`;

结论三: 交易逻辑上无关联，物理逻辑上`dom`结构属于嵌套，则在关闭时依然会均关闭;
:::

::: tip `结论三解释`
交易 A 异步打开交易 B,则交易 A 与交易 B 在逻辑上无关联，但是物理逻辑上`dom`结构属于嵌套

如下示例，那么在关闭交易 A 时依然会关闭交易 B

```html
<div id="tradeA">
  <div id="tradeB"></div>
</div>
```

:::

:::warning `结论`
结论四: 面板不可独立存在，不论是同步或异步的面板均归属于交易，创建面板必须在交易的上下文内，且当交易关闭时面板也一定会关闭

结论五: 面板 A 内`同步`打开面板 B，面板 B 的父级是面板 A，此时关闭面板 A 则会连带关闭面板 B

结论六: 面板 A 内`异步`打开面板 B，面板 B 的父级是交易，此时关闭面板 A 但是不会影响到面板 B

结论七: 面板 A 内`同步`打开交易 C，则认为交易 C 的父级是面板 A，此时关闭面板 A 则会连带关闭交易 C

结论八: 面板 A 内`异步`打开交易 C，则认为交易 C 是独立的存在，`无关联`，此时关闭面板 A 不会影响到交易 C
:::

:::tip `原则`
原则一：A 同步打开 B，则认为 A 在等待 B 返回，那么此时 A 会弹出一个阻塞的弹框等待 B 返回，此弹框可自定义，参考[自定义同步提示](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#setSyncLoading)
:::

:::tip `弹框类型`交易/面板

1. 弹框类型容器选择挂载目标很重要，请不要随意挂载，并且务必清楚与选择挂载到的元素之间的关联
2. 如果`targetId`在某个交易下，那么此交易被销毁时，`targetId`下的交易也会被销毁
3. 如果某个弹框交易想存活时间更长，可以选择挂载在类似`Home.vue`上，这样只有在签退后才会被销毁
4. 弹框类型的面板，即使不是挂载到交易的 dom 下，交易被销毁时，面板也会被销毁，且不论同异步，原因是因为面板是归属于交易
5. 如果某个画面保留周期较长，请务必选择交易而不是面板
   :::

:::tip 显示/隐藏

1. 显示/隐藏对应的是状态的切换
2. `tab`嵌套:从`tabB`切换到`tabA`时，`tradeA`交易会触发`_onShow`、且`tradeA1`也会触发`_onShow`

```html
<div id="tabA">
  <div id="tradeA">
    <div id="tabA1">
      <div id="tradeA1">show</div>
      <div id="tradeA2">hide</div>
    </div>
  </div>

  <div id="tradeB">hide</div>
</div>
<div id="tabB"></div>
```

:::

## 快速查询 {#快速查询}

| API               | description                                                                                     |
| :---------------- | :---------------------------------------------------------------------------------------------- |
| createTradeSync   | [创建同步交易](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#createTradeSync)              |
| createTradeAsync  | [创建异步交易](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#createTradeAsync)             |
| createPanelSync   | [创建同步面板](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#createPanelSync)              |
| createPanelAsync  | [创建异步面板](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#createPanelAsync)             |
| destroyTradeSync  | [销毁同步交易](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#destroyTradeSync)             |
| destroyTradeAsync | [销毁异步交易](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#destroyTradeAsync)            |
| destroyPanelSync  | [销毁同步面板](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#destroyPanelSync)             |
| destroyPanelAsync | [销毁异步面板](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#destroyPanelAsync)            |
| getParcelName     | [获取 parcel 的 name](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#getParcelName)         |
| getContainerId    | [获取容器的 id](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#getContainerId)              |
| getTargetId       | [获取挂载元素的 id](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#getTargetId)             |
| getContainer      | [获取容器](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#getContainer)                     |
| getDepartment     | [是交易还是面板](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#getDepartment)              |
| getParentContext  | [获取父级上下文](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#getParentContext)           |
| getTradeContext   | [获取交易上下文](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#getTradeContext)            |
| destroyTrade      | [销毁交易](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#destroyTrade)                     |
| destroyPanel      | [销毁面板](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#destroyPanel)                     |
| destroy           | [销毁](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#destroy)                              |
| setPanelExportVar | [设置面板出参](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#setPanelExportVar)            |
| getPanelImportVar | [获取面板入参](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#getPanelImportVar)            |
| setTradeExportVar | [设置交易出参](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#setTradeExportVar)            |
| getTradeImportVar | [获取交易入参](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#getTradeImportVar)            |
| switchTrade       | [切换交易](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#switchTrade)                      |
| switchPanel       | [切换面板](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#switchPanel)                      |
| getTradeId        | [获取交易 id](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#getTradeId)                    |
| getPanelId        | [获取面板 id](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#getPanelId)                    |
| dispatchMessage   | [发送消息](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#dispatchMessage)                  |
| getTradeList      | [获取交易列表](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#getTradeList)                 |
| getPanelList      | [获取面板列表](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#getPanelList)                 |
| getTradeConfig    | [获取交易配置信息](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#getTradeConfig)           |
| getTradePath      | [获取交易路径](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#getTradePath)                 |
| getPanelConfig    | [获取面板配置信息](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#getPanelConfig)           |
| getPanelPath      | [获取面板路径](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#getPanelPath)                 |
| setDefaultClosing | [设置关闭提示（画面级)](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#setDefaultClosing)   |
| wasTradeCreated   | [判断交易是否创建](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#判断交易是否创建)         |
| wasPanelCreated   | [判断面板是否创建](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#判断面板是否创建)         |
| turningTrade      | [book 类型交易翻页](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#turningTrade)            |
| turningPanel      | [book 类型面板翻页](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#turningPanel)            |
| setSyncLoading    | [自定义同步打开时的 loading](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#setSyncLoading) |

## 概念

- **交易**

交易指具备完善独立业务能力，由一个或者多个画面组成的用于帮助用户解决问题的工具

- **面板**

面板由一个画面组成，无法独立，归属于交易内，当交易销毁后，面板也会被销毁

- **画面**

技术维度，当前可看作`.vue`

## 引用

每个 `交易` 都是通过 `createTrade` 创建一个新的 交易实例：

```ts
import { createTradeSync, createPanelAsync } from "@agree/ab-manager-trade2";

createTradeSync({
  config: {
    title: "个人开卡", // 交易标题
    type: "bpmn", // 交易类型
    microName: "ABX5", // 微应用名称,可以不传入，默认为'ABX5'
    tradeName: "scene/个人开卡/开卡", // 交易技术维度的路径
    moduleName: "BankModule", // 交易所属的工程信息
    containerType: "tab", // 交易的展现类型
  },
  targetId: "", // 交易挂载的元素id
});
```

::: tip
使用交易管理器有两种方式：

```ts
// 1. 引用：
import { createTradeAsync } from "@agree/ab-manager-trade2";
createTradeAsync(tradeOptions);

// 2. 直接使用全局API
window.abx.createTradeAsync(tradeOptions);
```

:::

## 交易类型 {#交易类型}

```ts
enum TradeType {
  BPMN = "bpmn", // 多端协同流程交易
  AUF = "auf", // 单端画面流交易
  VUE = "vue", // 单画面交易
}
```

## 交易入参 {#交易入参}

> 创建交易的入参介绍

| name            | required | description       |
| :-------------- | :------: | :---------------- |
| config          |   true   | 交易信息          |
| targetId        |   true   | 交易挂载的元素 id |
| importVar       |  false   | 入参              |
| repeatable      |  false   | 是否可重复创建    |
| setDefaultFrame |  false   | 设置交易模版      |
| hooks           |  false   | 钩子函数          |
| context         |  false   | 父级上下文        |

### config {#tradeConfig}

交易信息

- **类型**

::: code-group

```ts [TradeArgsConfig]
type ContainerOptions = {
  showMax: boolean;
  showMinus: boolean;
  showClose: boolean;
  fullscreen: boolean;
  customStyle: Object;
  customClass: String | Array;
};

interface ITradeOptions {
  config: {
    title: string; // 交易标题
    type: TradeType; // 交易类型
    microName: string; // 微应用名称
    tradeName: string; // 交易技术维度的路径
    moduleName: string; // 交易所属的工程信息
    containerType: ContainerType; // 交易的展现类型
    containerOptions?: ContainerOptions; // 容器的配置
  };
}
```

```ts [TradeType]
enum TradeType {
  BPMN = "bpmn", // 多端协同流程交易
  AUF = "auf", // 单端画面流交易
  VUE = "vue", // 单画面交易
}
```

```ts [ContainerType]
enum ContainerType {
  TAB = "tab", // 页签
  WINDOW = "dialog", // 弹框
  BOOK = "book", // book
  BASE = "base", // 无类型
}
```

:::

- **详细信息**

`type` 表示交易的类型，参考 [交易类型](./交易管理器#交易类型)

`microName` 表示当前微应用的名称，参考[微应用](./微应用)

:::tip microName
微应用名称可以不传入，默认值`ABX5`
:::

- **示例**

```ts
createTradeSync({
  config: {
    title: "个人开卡", // 交易标题
    type: "bpmn", // 交易类型
    microName: "ABX5", // 微应用名称
    tradeName: "scene/个人开卡/开卡", // 交易技术维度的路径
    moduleName: "BankModule", // 交易所属的工程信息
    containerType: "tab", // 交易的展现类型
    containerOptions: {
      // dialog类型的容器的配置参数
      customStyle: {
        width: "200px",
        height: "200px",
      },
      showClose: true,
    },
  },
  // ...
});
```

### targetId

交易挂载的元素 id

- **类型**

```ts
interface ITradeOptions {
  targetId: Element.id;
}
```

- **示例**

```ts
const targetId = document.getElementById("trade-container").id;
```

### importVar

入参，可在画面内拿到

- **类型**

```ts
type ImportVar  = {
    [propName: string]?: any;
}

interface ITradeOptions {
  importVar?: ImportVar
}
```

- **详细信息**

::: code-group

```ts [Trade]
// 获取交易入参
const tradeImportVar = this.getContext().getTradeImportVar();
```

```ts [Panel]
// 获取面板入参
const panelImportVar = this.getContext().getPanelImportVar();
```

:::

- **示例**

```ts
createTradeSync({
  // ...
  importVar: {
    hostTradeData: {
      交易请求体: {
        "渠道/渠道信息": {
          渠道号: "C001",
        },
        "代理/代理信息": {
          代理标志: "0",
        },
      },
      BranchNum: "000000",
      UserNum: "rose",
    },
  },
  // ...
});
```

### repeatable

是否可重复创建交易

默认`不可重复创建`

- **类型**

```ts
type RepeatableFn = (config: TradeArgsConfig): boolean
type Repeatable = boolean | RepeatableFn

interface ITradeOptions {
  repeatable?: Repeatable
}

```

- **示例**

```ts
createTradeSync({
  // ...
  repeatable: true, // 可重复创建
  repeatable: (config) => {
    return config.tradeName == "scene/个人开卡/开卡" ? false : true;
  },
  // ...
});
```

### setDefaultFrame

设置交易模版

- **类型**

```ts
interface ITradeOptions {
  setDefaultFrame?: () => string;
}
```

- **示例**

```ts
createTradeSync({
  // ...
  setDefaultFrame:  => {
    return "ProjectName/pages/frame/基础布局"
  }
  // ...
})
```

- **详细信息**

  1.  设置交易模版，仅针对`BPMN类型`交易
  2.  如果在创建交易时设置，将会覆盖全局设置
  3.  如果交易内的画面也有设置模版，将会覆盖交易时的设置

  ::: tip
  global -> trade -> page
  :::

### hooks

设置钩子函数

- **类型**

```ts
interface ITradeOptions{
    hooks?: {
        _onErrorCaptured(err, args) {},
        _onMessage(e) {},
        _onBeforeUnmountTrade(e) {},
        _onUnmountedTrade(e) {},
        _onBeforeMountTrade(e) {},
        _onMountedTrade(e) {}
    }
}
```

- **详细信息**

参考[生命周期](./%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.md)

### context

设置父级上下文

- **类型**

```ts
interface ITradeOptions {
  context?: TradeContext | PanelContext;
}
```

- **示例**

```ts
createTradeSync({
  // ...
  context: this.getContext && this.getContext(),
  // ...
});
```

- **详细信息**

  1. 如果交易内创建子交易，则表明两者存在`父子`关系，则需要传入参数`context`

## 交易出参 {#交易出参}

> `异步`打开的交易`无返回值`

> `同步`打开的交易需要`await`, `有返回值`

- **类型**

```ts
enum IDestroyStatus {
  UNMOUNTED = "UNMOUNTED", // 销毁
  UNMOUNTABORT = "UNMOUNTABORT", // 取消销毁
  UNMOUNTED_ERROR = "UNMOUNTED_ERROR", // 销毁报错
}
interface IExportVar {}

interface IResult {
  getStatus: () => IDestroyStatus; // 获取销毁状态
  getExportVar: () => IExportVar; // 获取出参
}

function createTradeSync(tradeOptions: ITradeOptions): Promise<IResult>;
```

- **示例**

```ts{3-5,8,11}
import { createTradeSync } from '@agree/ab-manager-trade2'

let tradeResult = await createTradeSync({
  // ...
});

// 获取交易销毁的状态
let tradeStatus = tradeResult.getStatus()

// 获取交易的出参
let tradeExportVar = tradeResult.getExportVar()
```

::: tip
只有`同步`创建的交易`有返回值`
:::

## 面板入参 {#面板入参}

> 创建面板的入参介绍

| name       | required | description       |
| :--------- | :------: | :---------------- |
| config     |   true   | 面板信息          |
| targetId   |   true   | 面板挂载的元素 id |
| importVar  |  false   | 入参              |
| repeatable |  false   | 是否可重复创建    |
| hooks      |  false   | 钩子函数          |
| context    |  false   | 父级上下文        |

### config {#panelConfig}

面板信息

- **类型**

```ts
interface IPanelOptions {
  config: {
    title: string; // 面板标题
    type: TradeType; // 面板类型
    microName: string; // 微应用名称
    tradeName: string; // [!code  --] 交易技术维度的路径
    panelName: string; // [!code  ++] 面板技术维度的路径
    moduleName: string; // 面板所属的工程信息
    containerType: ContainerType; // 面板的展现类型
    containerOptions?: ContainerOptions; // 容器的配置
  };
}
```

::: tip
如果是面板，参数`config.tradeName`需要修改成`config.panelName`

其余使用方式请参考[交易入参/config](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#交易入参)
:::

### targetId

参考[交易入参/targetId](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#交易入参)

### importVar

参考[交易入参/importVar](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#交易入参)

### repeatable

参考[交易入参/repeatable](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#交易入参)

### hooks

设置钩子函数

- **类型**

```ts
interface IPanelOptions{
    hooks?: {
        _onErrorCaptured(err, args) {},
        _onMessage(e) {},
        _onBeforeUnmountPanel(e) {},
        _onUnmountedPanel(e) {},
        _onBeforeMountPanel(e) {},
        _onMountedPanel(e) {}
    }
}
```

- **详细信息**

参考[生命周期](./%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.md)

### context

参考[交易入参/context](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#交易入参)

## 面板出参 {#面板出参}

> `异步`打开的面板`无返回值`

> `同步`打开的面板需要`await`, `有返回值`

- **类型**

```ts
enum IDestroyStatus {
  UNMOUNTED = "UNMOUNTED", // 销毁
  UNMOUNTABORT = "UNMOUNTABORT", // 取消销毁
  UNMOUNTED_ERROR = "UNMOUNTED_ERROR", // 销毁报错
}
interface IExportVar {}

interface IResult {
  getStatus: () => IDestroyStatus; // 获取销毁状态
  getExportVar: () => IExportVar; // 获取出参
}

function createPanelSync(panelOptions: IPanelOptions): Promise<IResult>;
```

- **示例**

```ts{3-5,8,11}
import { createPanelSync } from '@agree/ab-manager-trade2'

let panelResult = await createPanelSync({
  // ...
});

// 获取面板销毁的状态
let panelStatus = panelResult.getStatus()

// 获取面板的出参
let panelExportVar = panelResult.getExportVar()
```

::: tip
只有`同步`创建的面板`有返回值`
:::

## 设置交易出入参数据 {#设置交易出入参数据}

> 交易(面板)有两组 API，分为入参，出参的设置以及获取

> 参考[上下文](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#上下文)

| API               | description  |
| :---------------- | :----------- |
| setPanelExportVar | 设置面板出参 |
| getPanelImportVar | 获取面板入参 |
| setTradeExportVar | 设置交易出参 |
| getTradeImportVar | 获取交易入参 |

### 设置入参

在创建面板或者交易时通过`importVar`设置入参,参考[交易入参](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#交易入参)

```ts{3}
createTradeSync({
  // ...
  importVar: {}
  // ...
})
```

### 获取出参

交易或者面板关闭后返回，可获取出参参考[交易出参](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#交易出参)

```ts{5}
let panelResult = await createTradeSync({
  // ...
})

let panelExportVar = panelResult.getExportVar()
console.log('面板的出参', panelExportVar)
```

::: tip
必须`await`的才可以获取出参，即必须调用同步的`API`
:::

## 创建交易 {#创建交易}

> 同步：指只有当前交易被销毁后才会返回，一般场景是需要得到交易返回的出参进行后续的逻辑

> 异步：交易创建后直接返回，不关心是否销毁，一般交易间没有相互关系时使用

| API              | description  |
| :--------------- | :----------: |
| createTradeSync  | 创建同步交易 |
| createTradeAsync | 创建异步交易 |

### createTradeSync {#createTradeSync}

创建同步交易

- **类型**

```ts
enum DestroyStatus {
  UNMOUNTABORT, // 取消销毁
  UNMOUNTED, // 完成销毁
  UNMOUNTED_ERROR, // 销毁报错
}

type ExportVar = TradeExportVar | PanelExportVar;

interface IResult {
  getStatus: () => DestroyStatus;
  getExportVar: () => ExportVar;
}

function createTradeSync(tradeOptions: ITradeOptions): IResult;
```

- **示例**

```ts
import { createTradeSync } from "@agree/ab-manager-trade2";

let tradeResult = await createTradeSync({
  // ...
});

// 获取交易销毁的状态
let tradeStatus = tradeResult.getStatus();

// 获取交易的出参
let tradeExportVar = tradeResult.getExportVar();
```

- **详细信息**

  1. 同步创建交易，只有当交易销毁后才会返回结果，需要`await`

### createTradeAsync {#createTradeAsync}

创建异步交易

- **类型**

```ts
function createTradeAsync(tradeOptions: ITradeOptions): ITrade;
```

- **示例**

```ts
import { createTradeSync } from "@agree/ab-manager-trade2";

let trade = createTradeAsync({
  // ...
});

// 如果希望外部销毁，可以按照如下调用
trade.destroy();
```

- **详细信息**

  1. 创建异步交易，不需要`await`, 但是无法获取交易的销毁状态

## 销毁交易 {#销毁交易}

> 同步：指销毁后，等待返回结果，一般应用于需要得知销毁结果以及获取交易出参的场景

> 异步：调用销毁，无需`await`，无法得知销毁的情况

| API               | description  |
| :---------------- | :----------: |
| destroyTradeSync  | 销毁同步交易 |
| destroyTradeAsync | 销毁异步交易 |

### destroyTradeSync {#destroyTradeSync}

销毁交易，同步

- **类型**

```ts
interface IDestroyTradeOptions {
  tradeId?: string;
  tradeName?: string;
}

function destroyTradeSync(destroyTradeOptions: IDestroyTradeOptions): ITrade;
```

- **示例**

```ts
import { destroyTradeSync } from "@agree/ab-manager-trade2";

let tradeResult = await destroyTradeSync({
  // tradeOptions.config.moduleName + tradeOptions.config.tradeName
  tradeName: "BankModule/scene/个人开卡/开卡",
  // tradeId: this.getContext().getTradeId(),
});

// 获取交易销毁的状态
let tradeStatus = tradeResult.getStatus();

// 获取交易的出参
let tradeExportVar = tradeResult.getExportVar();
```

- **详细信息**

  1. `tradeId`:一般应用于能获取交易`id`且交易重复创建的场景
  2. `tradeName`: 一般应用于可以获取`tradeName`的场景

### destroyTradeAsync {#destroyTradeAsync}

销毁交易，异步

- **类型**

```ts
interface IDestroyTradeOptions {
  tradeId?: string;
  tradeName?: string;
}

function destroyTradeAsync(destroyTradeOptions: IDestroyTradeOptions): ITrade;
```

- **示例**

```ts
import { destroyTradeAsync } from "@agree/ab-manager-trade2";

destroyTradeAsync({
  // tradeOptions.config.moduleName + tradeOptions.config.tradeName
  tradeName: "BankModule/scene/个人开卡/开卡",
  // tradeId: this.getContext().getTradeId(),
});
```

- **详细信息**
  1. 销毁交易异步，一般应用于需要在某种特殊场景下手动销毁交易

## 创建面板 {#创建面板}

> 同步：指只有当前面板被销毁后才会返回，一般场景是需要得到面板返回的出参进行后续的逻辑

> 异步：面板创建后直接返回，无需`await`

| API              | description  |
| :--------------- | :----------: |
| createPanelSync  | 创建同步面板 |
| createPanelAsync | 创建异步面板 |

::: tip
面板无法独立存在，一般在`trade`内创建`面板`，所以创建面板请务必传入`context`！！！
:::

### createPanelSync {#createPanelSync}

创建面板，同步

- **类型**

```ts
enum DestroyStatus {
  UNMOUNTABORT, // 取消销毁
  UNMOUNTED, // 完成销毁
  UNMOUNTED_ERROR, // 销毁报错
}

type ExportVar = TradeExportVar | PanelExportVar;

interface IResult {
  getStatus: () => DestroyStatus;
  getExportVar: () => ExportVar;
}

function createPanelSync(PanelOptions: IPanelOptions): IResult;
```

- **示例**

```ts
import { createPanelSync } from "@agree/ab-manager-trade2";

let panelResult = await createPanelSync({
  config: {
    panelName: "scene/panel/面板.vue",
    microName: "ABX5",
    moduleName: "BankModule",
    title: "面板同步",
    containerType: "dialog",
  },
  targetId: this.getContext().getContainerId(),
  context: this.getContext(),
  importVar: {},
  repeatable: false,
  hooks: {
    _onBeforeMountPanel(e) {
      console.log("创建面板前 - 面板级");
    },
    _onMountedPanel(e) {
      console.log("创建面板后 - 面板级");
    },
    _onBeforeUnmountPanel() {
      console.log("销毁面板前 - 面板级");
    },
    _onUnmountedPanel() {
      console.log("销毁面板后 - 面板级");
    },
  },
});

// 获取面板销毁的状态
let panelStatus = panelResult.getStatus();

// 获取面板的出参
let panelExportVar = panelResult.getExportVar();
```

- **详细信息**

  1. 同步创建面板，只有当面板销毁后才会返回结果，需要`await`

### createPanelAsync {#createPanelAsync}

创建异步面板

- **类型**

```ts
function createPanelAsync(panelOptions: IPanelOptions): IPanel;
```

- **示例**

```ts
import { createPanelAsync } from "@agree/ab-manager-trade2";

let panel = createPanelAsync({
  // ...
});

// 如果希望外部销毁，可以按照如下调用
panel.destroy();
```

- **详细信息**

  1. 创建异步面板，不需要`await`, 但是无法获取面板的销毁状态以及出参

## 销毁面板 {#销毁面板}

> 同步：指销毁后，等待返回结果，一般应用于需要得知销毁结果以及获取面板出参的场景

> 异步：调用销毁，无需`await`，无法得知销毁的情况

| API               | description  |
| :---------------- | :----------: |
| destroyPanelSync  | 销毁同步面板 |
| destroyPanelAsync | 销毁异步面板 |

### destroyPanelSync {#destroyPanelSync}

销毁面板，同步

- **类型**

```ts
interface IDestroyPanelOptions {
  panelId?: string;
  panelName?: string;
}

function destroyPanelSync(destroyPanelOptions: IDestroyPanelOptions): IPanel;
```

- **示例**

```ts
import { destroyPanelSync } from "@agree/ab-manager-trade2";

let panelResult = await destroyPanelSync({
  // panelOptions.config.moduleName + panelOptions.config.panelName
  panelName: "BankModule/scene/个人开卡/开卡/开卡.vue",
  // panelId: this.getContext().getPanelId(),
});

// 获取交易销毁的状态
let panelStatus = panelResult.getStatus();

// 获取交易的出参
let panelExportVar = panelResult.getExportVar();
```

- **详细信息**

  1. `panelId`:一般应用于能获取交易`id`且可重复创建的场景
  2. `panelName`: 一般应用于可以获取`panelName`的场景

### destroyPanelAsync {#destroyPanelAsync}

销毁面板，异步

- **类型**

```ts
interface IDestroyPanelOptions {
  panelId?: string;
  panelName?: string;
}

function destroyPanelAsync(destroyPanelOptions: IDestroyPanelOptions): IPanel;
```

- **示例**

```ts
import { destroyPanelAsync } from "@agree/ab-manager-trade2";

destroyPanelAsync({
  // panelOptions.config.moduleName + panelOptions.config.panelName
  panelName: "BankModule/scene/个人开卡/开卡/开卡.vue",
  // panelId: this.getContext().getPanelId(),
});
```

- **详细信息**

  1. 销毁面板异步，一般应用于需要在某种特殊场景下手动销毁面板

## 判断是否创建

> 判断交易或者面板是否创建

| API             |   description    |
| :-------------- | :--------------: |
| wasTradeCreated | 判断交易是否创建 |
| wasPanelCreated | 判断面板是否创建 |

### wasTradeCreated {#wasTradeCreated}

判断交易是否创建

:::tip
此方法同[this.getContext().wasTradeCreated](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#判断交易是否创建)
:::

- **类型**

```ts
type WasTradeCreatedArgs = {
  tradeId?: string;
  tradePath?: string;
};

function wasTradeCreated(args: WasTradeCreatedArgs): boolean;
```

:::tip
参数 `tradeId` 或者 `tradePath` 至少传入一个，否则报错
:::

- **示例**

```vue{10-14}
<script>
import { wasPanelCreated, wasTradeCreated } from "@agree/ab-manager-trade2"

export default {
  inject: ['getContext', '_parcelProps'],
  methods: {
    wasTradeCreated() {
      if (!this.getContext) throw new Error('画面内缺失context')

      let tradePath = "BankModule/scene/个人开卡/开卡"
      let wasCreated = wasTradeCreated({
        tradePath: tradePath,
        // tradeId: ""
      });
      console.log('交易是否创建', tradePath, wasCreated)

    }
  }
}
</script>
```

- **详细信息**
  1. 交易如果未创建则返回`false`

### wasPanelCreated {#wasPanelCreated}

判断面板是否创建

:::tip
此方法同[this.getContext().wasPanelCreated](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#判断面板是否创建)
:::

- **类型**

```ts
type WasPanelCreatedArgs = {
  panelId?: string;
  panelPath?: string;
};

function wasPanelCreated(args: WasPanelCreatedArgs): boolean;
```

:::tip
参数 `panelId` 或者 `panelPath` 至少传入一个，否则报错
:::

- **示例**

```vue{10-14}
<script>
import { wasPanelCreated, wasTradeCreated } from "@agree/ab-manager-trade2"

export default {
  inject: ['getContext', '_parcelProps'],
  methods: {
    wasTradeCreated() {
      if (!this.getContext) throw new Error('画面内缺失context')

      let panelPath = "BankModule/scene/个人开卡/开卡"
      let wasCreated = wasPanelCreated({
        panelPath: panelPath,
        // panelId: ""
      });
      console.log('面板是否创建', panelPath, wasCreated)

    }
  }
}
</script>
```

- **详细信息**
  1. 面板如果未创建则返回`false`

## 上下文 {#上下文}

> 交易或者面板的上下文，其提供一些便捷 `API`，便于交易过程中使用

| API                      | description                                          |
| :----------------------- | :--------------------------------------------------- |
| getParcelName            | 获取 parcel 的 name                                  |
| getContainerId           | 获取容器的 id                                        |
| getTargetId              | 获取挂载元素的 id                                    |
| getContainer             | 获取容器                                             |
| getDepartment            | 是交易还是面板                                       |
| getParentContext         | 获取父级上下文                                       |
| getTradeContext          | 获取交易上下文                                       |
| destroyTrade             | 销毁交易                                             |
| destroyPanel             | 销毁面板                                             |
| destroy                  | 销毁                                                 |
| setPanelExportVar        | 设置面板出参                                         |
| getPanelImportVar        | 获取面板入参                                         |
| setTradeExportVar        | 设置交易出参                                         |
| getTradeImportVar        | 获取交易入参                                         |
| switchTrade              | 切换交易                                             |
| switchPanel              | 切换面板                                             |
| getTradeId               | 获取交易 id                                          |
| getPanelId               | 获取面板 id                                          |
| dispatchMessage          | 发送消息                                             |
| getTradeList             | 获取交易列表                                         |
| getPanelList             | 获取面板列表                                         |
| getTradeConfig           | 获取交易配置信息                                     |
| getTradePath             | 获取交易路径                                         |
| getPanelConfig           | 获取面板配置信息                                     |
| getPanelPath             | 获取面板路径                                         |
| setDefaultClosing        | 设置关闭提示（画面级）                               |
| wasTradeCreated          | 判断交易是否创建                                     |
| wasPanelCreated          | 判断面板是否创建                                     |
| turningTrade             | book 类型交易翻页                                    |
| turningPanel             | book 类型面板翻页                                    |
| setSyncLoading           | 自定义同步打开时的 loading                           |
| createTradeSync          | 创建交易同步                                         |
| createTradeAsync         | 创建交易异步                                         |
| createPanelSync          | 创建面板同步                                         |
| createPanelAsync         | 创建面板异步                                         |
| destroyTradeSync         | 销毁交易同步                                         |
| destroyTradeAsync        | 销毁交易异步                                         |
| destroyPanelSync         | 销毁面板同步                                         |
| destroyPanelAsync        | 销毁面板异步                                         |
| tabContainerSwitchToNext | [页签切换](./交易管理器.md#tabContainerSwitchToNext) |

### 获取上下文

1. 创建交易

```ts
import { createTradeSync } from "@agree/ab-manager-trade2";

createTradeAsync({
  // ...
  config: {
    tradeName: "scene/个人开卡/开卡",
    moduleName: "BankModule",
    // ...
  },
  // ...
});
```

2. 交易画面内使用`context`

```vue{5}
<script>
// filePath: BankModule/scene/个人开卡/开卡/证件选择.vue

export default {
  inject: ['getContext', '_parcelProps'], // [!code  focus]
  methods: {
    getTradeId() {
      if (!this.getContext) throw new Error('画面内缺失context')

      let tradeId = this.getContext().getTradeId()
      console.log('获取交易id', tradeId)
    }
  }
}
</script>
```

### getParcelName {#getParcelName}

获取 parcel 的 name

- **类型**

```ts
function getParcelName(): string;
```

- **示例**

```vue{8}
<script>
export default {
  inject: ['getContext', '_parcelProps'],
  methods: {
    getParcelName() {
      if (!this.getContext) throw new Error('画面内缺失context')

      let parcelName = this.getContext().getParcelName()  // [!code  focus]
      console.log('获取parcelName', parcelName)
    }
  }
}
</script>
```

- **详细信息**

  1. 交易是通过微应用提供的`parcel`方式打开，所以会有`parcelName`，一般`同交易id`

### getContainerId {#getContainerId}

获取容器的 id

- **类型**

```ts
function getContainerId(): string;
```

- **示例**

```vue{8}
<script>
export default {
  inject: ['getContext', '_parcelProps'],
  methods: {
    getParcelName() {
      if (!this.getContext) throw new Error('画面内缺失context')

      let containerId = this.getContext().getContainerId()  // [!code  focus]
      console.log('获取容器的id', containerId)
    }
  }
}
</script>
```

- **详细信息**

  1. 交易(面板)的创建方式是通过的`target`，创建容器，创建交易，然后将交易挂载到容器，再将容器挂载到`target`

::: tip

```html{2,4}
<target>
  <container>
    <trade></trade>
  </container>
</target>
```

:::

### getTargetId {#getTargetId}

获取挂载元素的 id

- **类型**

```ts
function getTargetId(): string;
```

- **示例**

```vue{8}
<script>
export default {
  inject: ['getContext', '_parcelProps'],
  methods: {
    getParcelName() {
      if (!this.getContext) throw new Error('画面内缺失context')

      let targetId = this.getContext().getTargetId()  // [!code  focus]
      console.log('获取targetId', targetId)
    }
  }
}
</script>
```

```html
<multiple-panel id="trade_container_parcel"></multiple-panel>
```

- **详细信息**

  1. 获取交易挂载到元素的`id`

::: tip

```html{1,5}
<target>
  <container>
    <trade></trade>
  </container>
</target>
```

:::

### getContainer {#getContainer}

获取容器

- **类型**

```ts
function getContainer(): DOMElement;
```

- **示例**

```vue{8}
<script>
export default {
  inject: ['getContext', '_parcelProps'],
  methods: {
    getParcelName() {
      if (!this.getContext) throw new Error('画面内缺失context')

      let container = this.getContext().getContainer()  // [!code  focus]
      console.log('获取 container', container)
    }
  }
}
</script>
```

- **详细信息**

  1. 获取`container`

### getDepartment {#getDepartment}

是交易还是面板

- **类型**

```ts
enum ParcelType = {
  Trade,
  Panel
}
function getDepartment():ParcelType;
```

- **示例**

```vue{8}
<script>
export default {
  inject: ['getContext', '_parcelProps'],
  methods: {
    getParcelName() {
      if (!this.getContext) throw new Error('画面内缺失context')

      let department = this.getContext().getDepartment()  // [!code  focus]
      console.log('获取 department', department)
    }
  }
}
</script>
```

- **详细信息**

  1. 获取当前是交易或者面板

### getParentContext {#getParentContext}

获取父级上下文

- **类型**

```ts
type IContext = ITradeContext | IPanelContext;

function getParentContext(): IContext;
```

- **示例**

```vue{8}
<script>
export default {
  inject: ['getContext', '_parcelProps'],
  methods: {
    getParcelName() {
      if (!this.getContext) throw new Error('画面内缺失context')

      let parentContext = this.getContext().getParentContext()  // [!code  focus]
      console.log('获取父级上下文', parentContext)
    }
  }
}
</script>
```

- **详细信息**

  1. 如果交易内打开子交易或面板，则`parentContext`是`ITradeContext`
  2. 如果交易内打开面板，面板内再打开面板，则`parentContext`是`IPanelContext`

::: tip

1. trade -> trade: parentContext = trade
2. trade -> panel: parentContext = trade
3. panel -> panel: parentContext = panel
   :::

### getTradeContext {#getTradeContext}

获取交易上下文

- **类型**

```ts
function getTradeContext(): ITradeContext;
```

- **示例**

```vue{8}
<script>
export default {
  inject: ['getContext', '_parcelProps'],
  methods: {
    getParcelName() {
      if (!this.getContext) throw new Error('画面内缺失context')

      let tradeContext = this.getContext().getTradeContext()  // [!code  focus]
      console.log('获取交易上下文', tradeContext)
    }
  }
}
</script>
```

- **详细信息**

  1. 交易内打开交易，`tradeContext`是交易
  2. 面板内打开面板，`tradeContext`也是交易

::: tip

1. trade -> trade: tradeContext = trade
2. trade -> panel: tradeContext = trade
3. panel -> panel: tradeContext = trade
   :::

### destroyTrade {#destroyTrade}

销毁交易

- **类型**

```ts
type ExitType = {
  Abort = 'abort' // 中止退出
  Finish = 'finish' // 完成退出
  Pending = 'pending' // 挂起退出
}
interface IDestroyArgs {
  exitType?: ExitType
}
function destroyTrade(destroyArgs: IDestroyArgs): void
```

- **示例**

```vue{8,9}
<script>
export default {
  inject: ['getContext', '_parcelProps'],
  methods: {
    getParcelName() {
      if (!this.getContext) throw new Error('画面内缺失context')

      // this.getContext().destroyTrade()  // [!code  focus]
      this.getContext().destroyTrade({exitType: 'finish'})  // [!code  focus]
    }
  }
}
</script>
```

- **详细信息**

  1. 只有创建的是交易时，才可以在画面内调用`destroyTrade`
  2. 默认不传入参数时是`Abort`退出，即中止退出

### destroyPanel {#destroyPanel}

销毁面板

- **类型**

```ts
function destroyPanel(): void;
```

- **示例**

```vue{8}
<script>
export default {
  inject: ['getContext', '_parcelProps'],
  methods: {
    getParcelName() {
      if (!this.getContext) throw new Error('画面内缺失context')

      this.getContext().destroyPanel()  // [!code  focus]
    }
  }
}
</script>
```

- **详细信息**

  1. 销毁面板,只能在创建面板的画面内调用

### destroy {#destroy}

销毁，即可以销毁交易，也可以销毁面板

::: tip

1. 用法同[destroyPanel](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#destroyTrade)/[destroyTrade](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#destroyTrade)
2. 参数也保持一致
3. 建议采用此`API`
   :::

:::warning

如果是交易/面板内部关闭自己，建议采用异步方式

:::

- **详细信息**

  1. 销毁，创建的交易还是面板`均可`使用

### setPanelExportVar {#setPanelExportVar}

设置面板出参

- **类型**

```ts
function setPanelExportVar(exportVar: object): void;
```

- **示例**

```vue{8-10}
<script>
export default {
  inject: ['getContext', '_parcelProps'],
  methods: {
    getParcelName() {
      if (!this.getContext) throw new Error('画面内缺失context')

      this.getContext().setPanelExportVar({
        msg: "面板的出参设置"
      })
    }
  }
}
</script>
```

- **详细信息**

  1. 设置面板出参

### getPanelImportVar {#getPanelImportVar}

获取面板入参

- **类型**

```ts
function getPanelImportVar(): any;
```

- **示例**

```vue{8-9}
<script>
export default {
  inject: ['getContext', '_parcelProps'],
  methods: {
    getParcelName() {
      if (!this.getContext) throw new Error('画面内缺失context')

      let panelImportVar = this.getContext().getPanelImportVar()
      console.log('面板入参', panelImportVar)
    }
  }
}
</script>
```

- **详细信息**

### setTradeExportVar {#setTradeExportVar}

设置交易出参

- **类型**

```ts
function setTradeExportVar(exportVar: object): void;
```

- **示例**

```vue{8-10}
<script>
export default {
  inject: ['getContext', '_parcelProps'],
  methods: {
    getParcelName() {
      if (!this.getContext) throw new Error('画面内缺失context')

      this.getContext().setTradeExportVar({
        msg: "交易出参"
      })
    }
  }
}
</script>
```

- **详细信息**

  1. 设置交易出参

### getTradeImportVar {#getTradeImportVar}

获取交易入参

- **类型**

```ts
function getTradeImportVar(): any;
```

- **示例**

```vue{8-9}
<script>
export default {
  inject: ['getContext', '_parcelProps'],
  methods: {
    getParcelName() {
      if (!this.getContext) throw new Error('画面内缺失context')

      let tradeImportVar = this.getContext().getTradeImportVar()
      console.log('交易入参', tradeImportVar)
    }
  }
}
</script>
```

- **详细信息**

  1. 获取交易入参

### switchTrade {#switchTrade}

切换交易

- **类型**

```ts
type SwitchTradeArgs = {
  tradeId?: string;
  tradePath?: string;
};
function switchTrade(args: SwitchTradeArgs): void;
```

- **示例**

```vue{8-11}
<script>
export default {
  inject: ['getContext', '_parcelProps'],
  methods: {
    getParcelName() {
      if (!this.getContext) throw new Error('画面内缺失context')

      this.getContext().switchTrade({
        // tradeId:this.getContext().getTradeId(),
        tradePath: "BankModule/scene/个人开卡/开卡"
      })
    }
  }
}
</script>
```

- **详细信息**

  1. 切换交易，一般应用于`tab`页签打开方式的交易，相当于切换页签操作

::: tip
参数`tradeId`或者`tradePath`至少传入一个，否则报错
:::

### switchPanel {#switchPanel}

切换面板

- **类型**

```ts
type SwitchPanelArgs = {
  panelId?: string;
  panelPath?: string;
};
function switchPanel(args: SwitchPanelArgs): void;
```

- **示例**

```vue{8-11}
<script>
export default {
  inject: ['getContext', '_parcelProps'],
  methods: {
    getParcelName() {
      if (!this.getContext) throw new Error('画面内缺失context')

      this.getContext().switchPanel({
        // panelId:this.getContext().getPanelId(),
        panelPath: "BankModule/scene/个人开卡/开卡/面板.vue"
      })
    }
  }
}
</script>
```

- **详细信息**

  1. 切换面板，一般应用于`tab`页签打开方式的面板，相当于切换页签操作

::: tip
参数`panelId`或者`panelPath`至少传入一个，否则报错
:::

### getTradeId {#getTradeId}

获取交易 id

- **类型**

```ts
function getTradeId(): string;
```

- **示例**

```vue{8-9}
<script>
export default {
  inject: ['getContext', '_parcelProps'],
  methods: {
    getParcelName() {
      if (!this.getContext) throw new Error('画面内缺失context')

      let tradeId = this.getContext().getTradeId()
      console.log('交易id', tradeId)
    }
  }
}
</script>
```

- **详细信息**

  1. 获取交易唯一标识，不会重复

### getPanelId {#getPanelId}

获取面板 id

- **类型**

```ts
function getPanelId(): string;
```

- **示例**

```vue{8-9}
<script>
export default {
  inject: ['getContext', '_parcelProps'],
  methods: {
    getParcelName() {
      if (!this.getContext) throw new Error('画面内缺失context')

      let panelId = this.getContext().getPanelId()
      console.log('面板id', panelId)
    }
  }
}
</script>
```

- **详细信息**

  1. 获取面板唯一标识，不会重复

### dispatchMessage {#dispatchMessage}

发送消息

参考[dispatchMessage](./%E6%B6%88%E6%81%AF%E4%BC%A0%E9%80%92.md#dispatchMessage)

### getTradeList {#getTradeList}

获取交易列表

`开发中...`

### getPanelList {#getPanelList}

获取面板列表

`开发中...`

### getTradeConfig {#getTradeConfig}

获取交易配置信息

- **类型**

```ts
function getTradeConfig(): ITradeConfig;
```

- **示例**

```vue{8-9}
<script>
export default {
  inject: ['getContext', '_parcelProps'],
  methods: {
    getTradeConfig() {
      if (!this.getContext) throw new Error('画面内缺失context')

      let tradeConfig = this.getContext().getTradeConfig()
      console.log('交易配置信息', tradeConfig)
    }
  }
}
</script>
```

- **详细信息**

  1. 此处的`tradeConfig`指的就是在创建交易时传入的`ITradeOptions.config`,参考[config](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#tradeConfig)

### getTradePath {#getTradePath}

获取交易路径

- **类型**

```ts
function getTradePath(): string;
```

- **示例**

```vue{8-9}
<script>
export default {
  inject: ['getContext', '_parcelProps'],
  methods: {
    getTradePath() {
      if (!this.getContext) throw new Error('画面内缺失context')

      let tradePath = this.getContext().getTradePath()
      console.log('交易路径', tradePath)
    }
  }
}
</script>
```

- **详细信息**

  1. 此处的`tradePath`的获取原理是通过[getTradeConfig](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#getTradeConfig)内的`moduleName?+tradeName`拼接得到

:::tip
如果`moduleName`未配置，直接返回`tradeName`
:::

### getPanelConfig {#getPanelConfig}

获取面板配置信息

- **类型**

```ts
function getPanelConfig(): IPanelConfig;
```

- **示例**

```vue{8-9}
<script>
export default {
  inject: ['getContext', '_parcelProps'],
  methods: {
    getPanelConfig() {
      if (!this.getContext) throw new Error('画面内缺失context')

      let panelConfig = this.getContext().getPanelConfig()
      console.log('面板配置信息', panelConfig)
    }
  }
}
</script>
```

- **详细信息**

  1. 此处的`panelConfig`指的就是在创建面板时传入的`IPanelOptions.config`,参考[config](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#panelConfig)

### getPanelPath {#getPanelPath}

获取面板路径

- **类型**

```ts
function getPanelPath(): string;
```

- **示例**

```vue{8-9}
<script>
export default {
  inject: ['getContext', '_parcelProps'],
  methods: {
    getPanelPath() {
      if (!this.getContext) throw new Error('画面内缺失context')

      let panelPath = this.getContext().getPanelPath()
      console.log('面板路径', panelPath)
    }
  }
}
</script>
```

- **详细信息**

  1. 此处的`panelPath`的获取原理是通过[getPanelConfig](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#getPanelConfig)内的`moduleName?+PanelName`拼接得到

:::tip
如果`moduleName`未配置，直接返回`PanelName`
:::

### setDefaultClosing {#setDefaultClosing}

设置关闭提示（画面级）

:::tip
此方法可以自定义关闭提示、选择开启或关闭提示

此处仅为画面级，如果想设置交易以及全局级，请参考[设置关闭提示](./%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.md#设置关闭提示)
:::

- **类型**

```ts
enum DialogResult = {
  CANCEL, // 取消
  CONFIRM, // 确认
}

type IClosingResult = boolean | DialogResult
type IDefaultClosingCb = (e: ILifecycleArgs) => IClosingResult

function setDefaultClosing(callback: IDefaultClosingCb, _this?: this): void
```

:::tip
参考[ILifecycleArgs](./%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.md#钩子函数入参)
:::

- **示例**

```vue{8-17}
<script>
export default {
  inject: ['getContext', '_parcelProps'],
  methods: {
    _onMounted() {
      if (!this.getContext) throw new Error('画面内缺失context')

       this.getContext().setDefaultClosing(async (e)=>{
         // return false // 取消默认关闭提示
         // return true // 开启默认关闭提示

         // 自定义关闭提示
         // ...

         // return e.DialogResult.CANCEL // 取消关闭动作
         return e.DialogResult.CONFIRM // 关闭
      });

    }
  }
}
</script>
```

- **详细信息**

  1. 默认开启关闭提示
  2. 返回值有两种：`boolean`则代表开启或禁用关闭提示；`DialogResult`代表自定义关闭提示后，需要明确用户的操作结果
  3. 此处为`画面级`设置，还可以在`交易级`以及`全局级`设置，具体参考[\_setDefaultClosing](./%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F.md#设置关闭提示)
  4. 如果在`画面级 -> 交易级 -> 全局级`均设置，仅优先执行最后注册的，即执行优先级最高的，其余均忽略

::: tip 优先级
从高到低： `画面级 -> 交易级 -> 全局级`

执行优先级最高的，其余均忽略
:::

### wasTradeCreated {#判断交易是否创建}

判断交易是否创建

:::tip
基本使用同[wasTradeCreated](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#wasTradeCreated)
:::

- **类型**

```ts
type WasTradeCreatedArgs = {
  tradeId?: string;
  tradePath?: string;
};

function wasTradeCreated(args: WasTradeCreatedArgs): boolean;
```

:::tip
参数 `tradeId` 或者 `tradePath` 至少传入一个，否则报错
:::

- **示例**

```vue{8-12}
<script>
export default {
  inject: ['getContext', '_parcelProps'],
  methods: {
    wasTradeCreated() {
      if (!this.getContext) throw new Error('画面内缺失context')

      let tradePath = "BankModule/scene/个人开卡/开卡"
      let wasCreated = this.getContext().wasTradeCreated({
        tradePath: tradePath,
        // tradeId: ""
      });
      console.log('交易是否创建', tradePath, wasCreated)

    }
  }
}
</script>
```

- **详细信息**
  1. 交易如果未创建则返回`false`

### wasPanelCreated {#判断面板是否创建}

判断面板是否创建

:::tip
基本使用同[wasPanelCreated](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#wasPanelCreated)
:::

- **类型**

```ts
type WasPanelCreatedArgs = {
  panelId?: string;
  panelPath?: string;
};

function wasPanelCreated(args: WasPanelCreatedArgs): boolean;
```

:::tip
参数 `panelId` 或者 `panelPath` 至少传入一个，否则报错
:::

- **示例**

```vue{8-12}
<script>
export default {
  inject: ['getContext', '_parcelProps'],
  methods: {
    wasTradeCreated() {
      if (!this.getContext) throw new Error('画面内缺失context')

      let panelPath = "BankModule/scene/个人开卡/开卡"
      let wasCreated = this.getContext().wasPanelCreated({
        panelPath: panelPath,
        // panelId: ""
      });
      console.log('面板是否创建', panelPath, wasCreated)

    }
  }
}
</script>
```

- **详细信息**
  1. 面板如果未创建则返回`false`

### turningTrade {#turningTrade}

`book` 类型交易翻页

::: tip
仅支持`book`类型容器打开的交易翻页,参考[book](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#book)
:::

- **类型**

```ts
type TurningTradeArgs = {
  tradeId?: string;
  tradePath?: string;
};

function turningTrade(args: TurningTradeArgs): void;
```

:::tip
参数 `tradeId` 或者 `tradePath` 只能选择一个，否则报错
:::

- **示例**

```vue{7-15}
// Home.vue
<script>
export default {
  inject: ['getContext', '_parcelProps'],
  methods: {
    _onMessage(e) {
      e.registerEvent(["TurningBook"])

      if (!this.getContext) throw new Error('画面内缺失context')

      if(e.detail.receiver.eventName === "TurningBook"){
        this.getContext().turningTrade({
          tradePath: 'BankModule/pages/pc/frame/InternalServiceView.vue'
        })
      }

    }
  }
}
</script>
```

- **详细信息**
  1. 仅适用于`book`类型容器的交易

### turningPanel {#turningPanel}

`book` 类型面板翻页

::: tip
仅支持`book`类型容器打开的面板翻页,参考[book](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#book)
:::

- **类型**

```ts
type TurningPanelArgs = {
  panelId?: string;
  panelPath?: string;
};

function turningPanel(args: TurningPanelArgs): void;
```

:::tip
参数 `panelId` 或者 `panelPath` 只能选择一个，否则报错
:::

- **示例**

```vue{7-15}
// Home.vue
<script>
export default {
  inject: ['getContext', '_parcelProps'],
  methods: {
    _onMessage(e) {
      e.registerEvent(["TurningBook"])

      if (!this.getContext) throw new Error('画面内缺失context')

      if(e.detail.receiver.eventName === "TurningBook"){
        this.getContext().turningPanel({
          panelPath: 'BankModule/pages/pc/frame/panel1.vue'
        })
      }

    }
  }
}
</script>
```

- **详细信息**
  1. 仅适用于`book`类型容器的面板

### setSyncLoading {#setSyncLoading}

定义`同步`打开时的提示信息

:::warning
仅同步打开，即调用的 API 有后缀`Sync`
:::

- **类型**

开发中...

- **示例**

- **详细信息**

  1. 默认自带阻塞弹框
  2. 可自定义
  3. 仅在`同步情况`下使用

### createTradeSync

创建交易同步

:::tip

1. 同[创建同步交易](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#createTradeSync)
2. 此处可省略`context`，此时`context`为当前交易的上下文
   :::

### createTradeAsync

创建交易异步

:::tip

1. 同[创建异步交易](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#createTradeAsync)
   :::

### createPanelSync

创建面板同步

:::tip

1. 同[创建同步面板](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#createPanelSync)
2. 此处可省略`context`，此时`context`为当前面板的上下文
   :::

### createPanelAsync

创建面板异步

:::tip

1. 同[创建异步面板](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#createPanelAsync)

:::

### destroyTradeSync

销毁交易同步

:::tip

1. 同[销毁同步交易](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#destroyTradeSync)
2. 如果没有传入`tradeId`则默认为当前上下文交易
   :::

### destroyTradeAsync

销毁交易同步

:::tip

1. 同[销毁异步交易](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#destroyTradeAsync)
2. 如果没有传入`tradeId`则默认为当前上下文交易
   :::

### destroyPanelSync

销毁面板同步

:::tip

1. 同[销毁同步面板](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#destroyPanelSync)
2. 如果没有传入`panelId`则默认为当前上下文面板
   :::

### destroyPanelAsync

销毁面板异步

:::tip

1. 同[销毁异步面板](./%E4%BA%A4%E6%98%93%E7%AE%A1%E7%90%86%E5%99%A8.md#destroyPanelAsync)
2. 如果没有传入`panelId`则默认为当前上下文面板
   :::

### tabContainerSwitchToNext {#tabContainerSwitchToNext}

> 页签切换，用于容器为`tab`类型

- **类型**

```ts
type SwitchArgs = {
  targetId?: string; // 指定某个为tab类型容器的进行页签切换动作
};
function tabContainerSwitchToNext(args: SwitchArgs): void;
```

- **示例**

```vue{4,14-15,17-19}
<template>
	<div class="internal-service">
		<div class="trade-panel-inner-service trade-panel">
			<multiple-panel id="trade_container_parcel" ref="trade-panel_inner"></multiple-panel>
		</div>
	</div>
</template>
<script>
export default {
  methods: {
    tabContainerSwitchToNext() {
      if (!this.getContext) throw new Error('画面内缺失context')

      // 方式一：新版使用方式，建议使用
      this.getContext().tabContainerSwitchToNext({targetId: "trade_container_parcel"})

      // 方式二：用于兼容AB5原有使用方式
      this.$mutiPanelNextTab(this.$refs["trade-panel_inner"])
      // this.$refs["trade-panel_inner"].mutiPanelNextTab()
    }
  }
}
</script>
```

- **详细信息**

  1. 参数`targetId`可以不传入，此时默认查找当前交易所属的`targetId`,一般应用于创建于页签内的交易

## 容器

> 交易管理器自带的容器，共有四种类型，也支持用户自定义

:::tip
更多参考[容器](../sdk/ab-manager-container-provider.md)
:::

- **类型**

```ts
type ContainerOptions = any;

enum ContainerType {
  TAB = "tab", // 页签
  WINDOW = "dialog", // 弹框
  BOOK = "book", // book
  BASE = "base", // 无类型
}
```

- **使用**

```ts [ContainerType]
createTradeSync({
  config: {
    // ..
    containerType: 'book'
    containerOptions: {
      bookActive: true
    },
  },
  // ...
});
```

### tab

> 页签类型

:::tip
如果打开的交易希望可以同时查看互不影响，则可以使用此类型
:::

```ts
type ContainerOptions = never; // 无参数
```

### dialog

> 弹框类型

:::tip
如果打开的交易为弹框展示，一般应用于查询类，通知类
:::

```ts
type ContainerOptions = {
  customStyle: {
    width: string;
    height: string;
  };
  showClose: boolean;
};
```

- **详细信息**
  1. 待补充
  <!-- TODO:  -->

### book {#book}

> 书签面板

:::tip
如果打开的交易希望叠加在一起，相互切换显示类似于翻书则可以使用此类型
:::

```ts
type ContainerOptions = {
  activeBook: boolean;
};
```

- **详细信息**
  1. `activeBook`默认为`false`：表示书页被创建后是否显示

### base

> 无类型

:::tip
如果打开的交易直接挂载到目标元素，不需要容器则使用此类型
:::

```ts
type ContainerOptions = never; // 无参数
```

### 自定义容器

> 如果当前提供容器类型不满足使用，可自定义

```ts
createTradeSync({
  // ...
  containerProvider: {
    provide(args) {
      // 创建容器
      return {
        domElement,
        // ... 事件
      };
    },
    recycle() {
      // 销毁
    },
  },
});
```
